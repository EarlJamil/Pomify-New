<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pomodoro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
      body {
        font-family: "Arial", sans-serif;
        background: #fff;
      }
      .sidebar {
        background: #f9f9f9;
        min-height: 100vh;
        padding-top: 20px;
        border-right: 1px solid #ddd;
      }
      .sidebar .nav-link {
        color: #000;
        font-weight: 500;
        padding: 10px 20px;
      }
      .sidebar .nav-link.active {
        background: #3b2b29;
        color: #fff;
        border-radius: 6px;
      }
      .topbar {
        border-bottom: 1px solid #ddd;
        padding: 10px 20px;
      }
      .circle {
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: #f5c5c5;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: auto;
      }
      #time {
        font-size: 70px;
        font-weight: bold;
        color: #000;
      }
      #status {
        font-size: 18px;
        font-weight: 600;
        color: #a00000;
        margin-top: 10px;
      }
      .timer-buttons button {
        padding: 10px 25px;
        margin: 15px 10px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
      }
      .btn-red {
        background: #a00000;
        color: #fff;
      }
      .btn-red:hover {
        background: #ff4d4d;
      }
      .btn-gray {
        background: #aaa;
        color: #fff;
      }
      .task-list {
        width: 350px;
        margin: 30px auto;
        background: #f9f9f9;
        border-radius: 10px;
        padding: 15px;
        border: 1px solid #ddd;
      }
      .task-list li {
        background: #fff;
        border-radius: 8px;
        padding: 6px 10px;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid #ddd;
      }
      .task-list li.done span {
        text-decoration: line-through;
        color: gray;
      }
      .task-list li.active {
        border: 2px solid #a00000;
      }
      .task-list input {
        flex: 1;
        margin-right: 8px;
      }
      button:disabled {
        cursor: not-allowed !important;
      }
    </style>
  </head>
  <body>
    
    <div class="container-fluid">
      <div class="row">
        <div class="col-12 col-md-10 p-0 mx-auto">
          <div class="d-flex flex-column align-items-center justify-content-center mt-5">
            <h2 class="fw-bold text-danger">POMODORO</h2>

            <!-- Editable Pomodoro Time -->
            <div class="d-flex align-items-center gap-3 mb-3">
              <div>
                <label class="fw-semibold">Work (min):</label>
                <input type="number" id="workTime" value="25" min="1" class="form-control w-auto d-inline-block">
              </div>
              <div>
                <label class="fw-semibold">Break (min):</label>
                <input type="number" id="breakTime" value="5" min="1" class="form-control w-auto d-inline-block">
              </div>
            </div>

            <div class="circle">
              <div id="time">25:00</div>
              <div id="status">FOCUS</div>
            </div>
            <div class="timer-buttons mt-3">
              <button id="startBtn" class="btn-red" onclick="startTimer()">Start</button>
              <button id="resetBtn" class="btn-gray" onclick="resetTimer()" disabled>Reset</button>
            </div>
          </div>

          <!-- Task List -->
          <div class="task-list text-start">
            <h5 class="text-danger fw-bold"><i class="bi bi-list-check me-1"></i> Tasks</h5>
            <div class="input-group mb-3">
              <input id="taskInput" type="text" class="form-control" placeholder="Add a new task...">
              <button class="btn btn-danger" onclick="addTask()"><i class="bi bi-plus-lg"></i></button>
            </div>
            <ul id="taskItems" class="list-unstyled mb-0"></ul>
          </div>

          <audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>
        </div>
      </div>
    </div>

    <script>
      let timer;
      let isWork = true; 
      let timeLeft = 25 * 60;
      let activeTask = null; // track the currently active task

      const startBtn = document.getElementById("startBtn");
      const resetBtn = document.getElementById("resetBtn");

      function updateDisplay() {
        let minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;
        document.getElementById("time").innerHTML =
          (minutes < 10 ? "0" : "") + minutes + ":" +
          (seconds < 10 ? "0" : "") + seconds;
      }

      function startTimer() {
        clearInterval(timer);
        let workMinutes = parseInt(document.getElementById("workTime").value);
        let breakMinutes = parseInt(document.getElementById("breakTime").value);
        if (isWork) timeLeft = workMinutes * 60; 
        else timeLeft = breakMinutes * 60;

        startBtn.disabled = true; 
        resetBtn.disabled = false; 

        timer = setInterval(function () {
          if (timeLeft > 0) {
            timeLeft--;
            updateDisplay();
          } else {
            clearInterval(timer);
            document.getElementById("alarm").play();

            if (isWork && activeTask) {
              // cross out the current active task when Pomodoro ends
              activeTask.classList.add("done");
              activeTask.classList.remove("active");
              activeTask = null;
            }

            isWork = !isWork;
            document.getElementById("status").innerHTML = isWork ? "Work Session" : "Break Time!";
            startBtn.disabled = false;
            updateDisplay();
          }
        }, 1000);
        document.getElementById("status").innerHTML = isWork ? "Work Session" : "Break Time!";
      }

      function resetTimer() {
        clearInterval(timer);
        isWork = true;
        let workMinutes = parseInt(document.getElementById("workTime").value);
        timeLeft = workMinutes * 60;
        document.getElementById("status").innerHTML = "Ready";
        updateDisplay();
        startBtn.disabled = false; 
        resetBtn.disabled = true; 
      }

      // --- Task System ---
      function addTask() {
        const input = document.getElementById("taskInput");
        const text = input.value.trim();
        if (!text) return;

        const li = document.createElement("li");
        li.innerHTML = `
          <span>${text}</span>
          <div>
            <button class="btn btn-sm btn-outline-danger me-1" onclick="removeTask(this)">
              <i class="bi bi-trash"></i>
            </button>
            <button class="btn btn-sm btn-outline-dark" onclick="setActiveTask(this)">
              <i class="bi bi-hourglass-split"></i>
            </button>
          </div>
        `;

        document.getElementById("taskItems").appendChild(li);
        input.value = "";
      }

      function removeTask(btn) {
        const li = btn.closest("li");
        if (li === activeTask) activeTask = null;
        li.remove();
      }

      function setActiveTask(btn) {
        document.querySelectorAll("#taskItems li").forEach(li => li.classList.remove("active"));
        activeTask = btn.closest("li");
        activeTask.classList.add("active");
      }

      updateDisplay();
    </script>
  </body>
</html>
